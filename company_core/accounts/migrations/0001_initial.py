# Generated by Django 4.2.27 on 2026-01-15 13:49

import datetime
from decimal import Decimal
from django.conf import settings
import django.core.validators
from django.db import migrations, models
import django.db.models.deletion
import django.db.models.functions.text
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='BankConnection',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('provider', models.CharField(choices=[('flinks', 'Flinks')], default='flinks', max_length=20)),
                ('connection_id', models.CharField(max_length=128)),
                ('institution_name', models.CharField(blank=True, max_length=120)),
                ('status', models.CharField(choices=[('connected', 'Connected'), ('disconnected', 'Disconnected'), ('error', 'Error')], default='connected', max_length=20)),
                ('access_token', models.TextField(blank=True, null=True)),
                ('refresh_token', models.TextField(blank=True, null=True)),
                ('env', models.CharField(choices=[('sandbox', 'Sandbox'), ('production', 'Production')], default='production', max_length=16)),
                ('last_sync_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='bank_connections', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Bank Connection',
                'verbose_name_plural': 'Bank Connections',
            },
        ),
        migrations.CreateModel(
            name='BusinessBookingSettings',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('start_time', models.TimeField(default=datetime.time(9, 0), help_text='Opening time for online bookings.')),
                ('end_time', models.TimeField(default=datetime.time(17, 0), help_text='Closing time for online bookings.')),
                ('slot_interval_minutes', models.PositiveIntegerField(default=60, help_text='Length of each appointment slot in minutes.')),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Booking business setting',
                'verbose_name_plural': 'Booking business settings',
            },
        ),
        migrations.CreateModel(
            name='BusinessHoliday',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField(unique=True)),
                ('reason', models.CharField(blank=True, max_length=255)),
                ('notes', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'ordering': ['date'],
            },
        ),
        migrations.CreateModel(
            name='Category',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True, null=True)),
                ('image', models.ImageField(blank=True, null=True, upload_to='category_images/')),
                ('sort_order', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
            ],
        ),
        migrations.CreateModel(
            name='CategoryAttribute',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=120)),
                ('description', models.TextField(blank=True, null=True)),
                ('value_unit', models.CharField(blank=True, max_length=40, null=True)),
                ('attribute_type', models.CharField(choices=[('select', 'Select'), ('text', 'Text'), ('number', 'Number'), ('boolean', 'Yes/No')], default='select', max_length=20)),
                ('is_filterable', models.BooleanField(default=True)),
                ('is_comparable', models.BooleanField(default=False)),
                ('sort_order', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('category', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attributes', to='accounts.category')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='category_attributes', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['sort_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='CategoryAttributeOption',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('value', models.CharField(max_length=120)),
                ('sort_order', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('attribute', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='options', to='accounts.categoryattribute')),
            ],
            options={
                'ordering': ['sort_order', 'value'],
            },
        ),
        migrations.CreateModel(
            name='Customer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('portal_signup_status', models.CharField(choices=[('pending', 'Pending approval'), ('approved', 'Approved')], default='approved', help_text='Controls whether customer portal access is pending approval.', max_length=20)),
                ('name', models.CharField(max_length=100)),
                ('email', models.EmailField(blank=True, max_length=254, null=True)),
                ('cc_emails', models.TextField(blank=True, help_text='Additional CC email addresses, separated by commas.', null=True)),
                ('address', models.TextField(blank=True, null=True)),
                ('phone_number', models.CharField(blank=True, max_length=20, null=True)),
                ('gst_hst_number', models.CharField(blank=True, max_length=20, null=True)),
                ('next_followup', models.DateField(blank=True, null=True)),
                ('collection_notes', models.TextField(blank=True, null=True)),
                ('collect_gst_hst', models.BooleanField(default=False, verbose_name='Do you collect GST/HST from this customer?')),
                ('quickbooks_customer_id', models.CharField(blank=True, help_text='Identifier for the matching customer in QuickBooks.', max_length=64, null=True)),
                ('charge_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='Charge rate (per hour)')),
                ('vehicle_count', models.PositiveIntegerField(default=0, editable=False, verbose_name='Number of Unique Vehicles')),
                ('portal_user', models.OneToOneField(blank=True, help_text='Login account for this customer', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='customer_portal', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Driver',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('gst_hst_number', models.CharField(blank=True, max_length=50, null=True)),
                ('license_number', models.CharField(blank=True, max_length=50, null=True)),
                ('phone', models.CharField(blank=True, max_length=20, null=True)),
                ('email', models.EmailField(blank=True, max_length=254, null=True)),
                ('address', models.TextField(blank=True, null=True)),
                ('pay_gst_hst', models.BooleanField(default=False)),
                ('pay_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='Pay rate (per hour)')),
                ('extra_hours', models.DecimalField(decimal_places=2, default=0, max_digits=5, verbose_name='Extra hours')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='EmergencyRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('full_name', models.CharField(max_length=120)),
                ('phone', models.CharField(max_length=20)),
                ('email', models.EmailField(blank=True, max_length=254, null=True)),
                ('issue_type', models.CharField(choices=[('breakdown', 'Breakdown'), ('electrical', 'Electrical Issue'), ('brakes', 'Brake Issue'), ('tire', 'Tire/Flat'), ('no_start', 'No Start'), ('other', 'Other')], max_length=32)),
                ('location', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('acknowledged', models.BooleanField(default=False)),
            ],
        ),
        migrations.CreateModel(
            name='Employee',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('first_name', models.CharField(max_length=100)),
                ('last_name', models.CharField(max_length=100)),
                ('email', models.EmailField(blank=True, max_length=254, null=True)),
                ('phone', models.CharField(blank=True, max_length=20, null=True)),
                ('role', models.CharField(choices=[('mechanic', 'Mechanic'), ('admin', 'Admin'), ('other', 'Other')], default='mechanic', max_length=30)),
                ('status', models.CharField(choices=[('active', 'Active'), ('inactive', 'Inactive'), ('terminated', 'Terminated')], default='active', max_length=20)),
                ('hire_date', models.DateField(blank=True, null=True)),
                ('termination_date', models.DateField(blank=True, null=True)),
                ('hourly_rate', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='FleetVehicle',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('make', models.CharField(blank=True, max_length=50, null=True)),
                ('model', models.CharField(blank=True, max_length=50, null=True)),
                ('year', models.PositiveIntegerField(blank=True, null=True)),
                ('vin_number', models.CharField(max_length=17, unique=True)),
                ('license_plate', models.CharField(blank=True, max_length=15, null=True)),
                ('truck_number', models.CharField(blank=True, max_length=50, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='fleet_vehicles', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Fleet Vehicle',
                'verbose_name_plural': 'Fleet Vehicles',
                'ordering': ['make', 'model', 'vin_number'],
            },
        ),
        migrations.CreateModel(
            name='GroupedInvoice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('stripe_invoice_id', models.CharField(blank=True, help_text='The Stripe Invoice ID so we can fetch invoice_pdf', max_length=255, null=True)),
                ('po_number', models.CharField(blank=True, max_length=20, null=True)),
                ('date', models.DateField(null=True)),
                ('date_fully_paid', models.DateField(blank=True, null=True)),
                ('date_from', models.DateField(null=True)),
                ('date_to', models.DateField(null=True)),
                ('bill_to', models.CharField(max_length=50, null=True)),
                ('bill_to_address', models.TextField(blank=True, null=True)),
                ('bill_to_email', models.EmailField(max_length=254, null=True)),
                ('vin_no', models.CharField(max_length=17, null=True)),
                ('mileage', models.FloatField(null=True)),
                ('unit_no', models.CharField(max_length=64, null=True)),
                ('make_model', models.CharField(max_length=25, null=True)),
                ('license_plate', models.CharField(blank=True, max_length=20, null=True)),
                ('invoice_number', models.CharField(blank=True, editable=False, max_length=20, null=True)),
                ('total_amount', models.DecimalField(decimal_places=2, default=0, editable=False, max_digits=10)),
                ('stripe_payment_link', models.URLField(blank=True, max_length=500, null=True)),
                ('stripe_subscription_link', models.URLField(blank=True, max_length=500, null=True)),
                ('clover_order_id', models.CharField(blank=True, help_text='Clover order ID used for online/pos payments.', max_length=64, null=True)),
                ('clover_payment_link', models.URLField(blank=True, max_length=500, null=True)),
                ('quickbooks_invoice_id', models.CharField(blank=True, help_text='Identifier for the matching invoice in QuickBooks.', max_length=64, null=True)),
                ('quickbooks_sync_token', models.CharField(blank=True, help_text='QuickBooks sync token used for optimistic locking.', max_length=64, null=True)),
                ('quickbooks_last_sync_at', models.DateTimeField(blank=True, null=True)),
                ('quickbooks_needs_sync', models.BooleanField(db_index=True, default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_subscription', models.BooleanField(default=False, help_text='Create a recurring subscription instead of a one-time payment')),
                ('subscription_frequency', models.CharField(blank=True, choices=[('daily', 'Daily'), ('weekly', 'Weekly'), ('biweekly', 'Bi-Weekly'), ('monthly', 'Monthly'), ('quarterly', 'Quarterly'), ('yearly', 'Yearly')], max_length=10, null=True)),
                ('tax_exempt', models.BooleanField(default=False)),
                ('tax_exempt_reason', models.CharField(blank=True, max_length=255, null=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('customer', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='invoices', to='accounts.customer')),
                ('driver', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounts.driver')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Invoice',
                'verbose_name_plural': 'Invoices',
            },
        ),
        migrations.CreateModel(
            name='IncomeRecord2',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('job', models.CharField(blank=True, max_length=2000)),
                ('qty', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, null=True)),
                ('rate', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10, null=True)),
                ('amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), editable=False, max_digits=10)),
                ('tax_collected', models.DecimalField(decimal_places=2, default=Decimal('0.00'), editable=False, max_digits=10)),
                ('line_order', models.PositiveIntegerField(default=0)),
                ('date', models.DateField(blank=True, null=True)),
                ('ticket', models.CharField(max_length=16, null=True)),
                ('jobsite', models.CharField(max_length=16, null=True)),
                ('truck', models.CharField(max_length=16, null=True)),
                ('quickbooks_line_id', models.CharField(blank=True, help_text='Identifier for the matching line item in QuickBooks.', max_length=64, null=True)),
                ('driver', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounts.driver')),
                ('grouped_invoice', models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, related_name='income_records', to='accounts.groupedinvoice')),
            ],
            options={
                'verbose_name': 'Invoice Line Item',
                'verbose_name_plural': 'Invoice Line Items',
                'ordering': ['line_order', 'id'],
            },
        ),
        migrations.CreateModel(
            name='Mechanic',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('phone', models.CharField(blank=True, max_length=20, null=True)),
                ('email', models.EmailField(blank=True, max_length=254, null=True)),
                ('portal_user', models.OneToOneField(blank=True, help_text='Login account for this mechanic', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='mechanic_portal', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='MechExpense',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('vendor', models.CharField(max_length=50)),
                ('date', models.DateField(null=True)),
                ('receipt_no', models.CharField(blank=True, max_length=20, null=True, unique=True)),
                ('categorie', models.CharField(max_length=50, null=True)),
                ('unit_number', models.CharField(blank=True, max_length=50, null=True)),
                ('odometer_reading', models.IntegerField(blank=True, null=True)),
                ('paid', models.BooleanField(default=False)),
                ('start_date', models.DateField(blank=True, null=True)),
                ('end_date', models.DateField(blank=True, null=True)),
                ('tax_included', models.BooleanField(default=False)),
                ('province', models.CharField(blank=True, choices=[('AB', 'Alberta'), ('BC', 'British Columbia'), ('MB', 'Manitoba'), ('NB', 'New Brunswick'), ('NL', 'Newfoundland and Labrador'), ('NT', 'Northwest Territories'), ('NS', 'Nova Scotia'), ('NU', 'Nunavut'), ('ON', 'Ontario'), ('PE', 'Prince Edward Island'), ('QC', 'Quebec'), ('SK', 'Saskatchewan'), ('YT', 'Yukon'), ('CU', 'Custom')], max_length=2, null=True)),
                ('custom_tax_rate', models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ('record_in_inventory', models.BooleanField(default=True, help_text='When enabled, expense items update inventory stock levels.')),
                ('is_recurring', models.BooleanField(default=False)),
                ('frequency', models.CharField(blank=True, choices=[('daily', 'Daily'), ('weekly', 'Weekly'), ('biweekly', 'Bi-Weekly'), ('monthly', 'Monthly'), ('quarterly', 'Quarterly'), ('yearly', 'Yearly')], max_length=10, null=True)),
                ('next_occurrence', models.DateField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Receipt',
                'verbose_name_plural': 'Receipts',
            },
        ),
        migrations.CreateModel(
            name='MechExpenseItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('part_no', models.CharField(blank=True, max_length=50, null=True)),
                ('description', models.TextField(null=True)),
                ('qty', models.FloatField(default=1)),
                ('price', models.FloatField(default=0)),
                ('amount', models.FloatField(default=0, editable=False)),
                ('tax_paid', models.FloatField(default=0, editable=False)),
                ('mech_expense', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='accounts.mechexpense')),
            ],
            options={
                'verbose_name': 'Expense Item',
                'verbose_name_plural': 'Expense Items',
            },
        ),
        migrations.CreateModel(
            name='PayrollRun',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('period_start', models.DateField()),
                ('period_end', models.DateField()),
                ('pay_date', models.DateField(blank=True, null=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('approved', 'Approved'), ('paid', 'Paid')], default='draft', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('paid_at', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_payroll_runs', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_payroll_runs', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payroll_runs', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='PayrollTaxYear',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('year', models.PositiveIntegerField(unique=True)),
                ('cpp_rate', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=6)),
                ('cpp_basic_exemption', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('cpp_max_pensionable', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('cpp2_rate', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=6)),
                ('cpp2_max_pensionable', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('ei_rate', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=6)),
                ('ei_max_insurable', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('ei_employer_multiplier', models.DecimalField(decimal_places=4, default=Decimal('1.4000'), max_digits=6)),
                ('federal_basic_personal_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
            ],
        ),
        migrations.CreateModel(
            name='PayStub',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('hours', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=8)),
                ('regular_hours', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=8)),
                ('overtime_hours', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=8)),
                ('regular_pay', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('overtime_pay', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('gross_pay', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('taxable_income', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('federal_tax', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('provincial_tax', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('cpp_employee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('cpp_employer', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('cpp2_employee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('cpp2_employer', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('ei_employee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('ei_employer', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('other_deductions', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('net_pay', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('employer_total', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='paystubs', to='accounts.employee')),
                ('payroll_run', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='paystubs', to='accounts.payrollrun')),
            ],
        ),
        migrations.CreateModel(
            name='Plan',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=50)),
                ('stripe_plan_id', models.CharField(max_length=100)),
            ],
        ),
        migrations.CreateModel(
            name='Product',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('sku', models.CharField(blank=True, max_length=100, null=True)),
                ('name', models.CharField(max_length=150)),
                ('description', models.TextField(blank=True, null=True)),
                ('item_type', models.CharField(choices=[('inventory', 'Inventory'), ('non_inventory', 'Non-inventory')], default='inventory', max_length=20)),
                ('quickbooks_item_id', models.CharField(blank=True, help_text='Identifier for the matching product in QuickBooks.', max_length=64, null=True)),
                ('cost_price', models.DecimalField(decimal_places=2, max_digits=10)),
                ('sale_price', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('promotion_price', models.DecimalField(blank=True, decimal_places=2, help_text='Optional promotional price shown on the storefront.', max_digits=10, null=True)),
                ('margin', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('quantity_in_stock', models.PositiveIntegerField(default=0)),
                ('reorder_level', models.PositiveIntegerField(default=0)),
                ('image', models.ImageField(blank=True, null=True, upload_to='product_images/')),
                ('is_published_to_store', models.BooleanField(default=False, help_text='Display this product on your public storefront.')),
                ('is_featured', models.BooleanField(default=False, help_text='Highlight this product in featured storefront sections.')),
                ('warranty_expiry_date', models.DateField(blank=True, null=True)),
                ('warranty_length', models.PositiveIntegerField(blank=True, help_text='Warranty length in days', null=True)),
                ('location', models.CharField(blank=True, max_length=100, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='ProductBrand',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=120)),
                ('description', models.TextField(blank=True, null=True)),
                ('logo', models.ImageField(blank=True, null=True, upload_to='brand_logos/')),
                ('sort_order', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='product_brands', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['sort_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='PublicBooking',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('full_name', models.CharField(max_length=120)),
                ('email', models.EmailField(max_length=254)),
                ('phone', models.CharField(blank=True, max_length=20, null=True)),
                ('company', models.CharField(blank=True, max_length=120, null=True)),
                ('service_type', models.CharField(choices=[('engine', 'Engine Diagnostics & Repair'), ('transmission', 'Transmission Services'), ('brakes', 'Brake System Services'), ('electrical', 'Electrical Systems'), ('dpf', 'DPF & Emissions Service'), ('maintenance', 'Preventive Maintenance'), ('dot', 'DriveON (MTO) Inspections'), ('emergency', 'Emergency Service'), ('other', 'Other')], max_length=32)),
                ('pickup_location', models.CharField(blank=True, max_length=255, null=True)),
                ('dropoff_location', models.CharField(blank=True, max_length=255, null=True)),
                ('preferred_datetime', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('status', models.CharField(choices=[('new', 'New'), ('seen', 'Seen'), ('processing', 'Processing'), ('scheduled', 'Scheduled'), ('closed', 'Closed')], default='new', max_length=20)),
            ],
        ),
        migrations.CreateModel(
            name='Service',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.TextField()),
                ('description', models.TextField(blank=True)),
                ('fixed_hours', models.DecimalField(blank=True, decimal_places=2, help_text='Optional default quantity to apply when this service is selected.', max_digits=6, null=True)),
                ('fixed_rate', models.DecimalField(blank=True, decimal_places=2, help_text='Optional default rate/price to apply when this service is selected.', max_digits=10, null=True)),
                ('due_after_kilometers', models.PositiveIntegerField(blank=True, help_text='Optional interval in kilometers after which this service is due.', null=True)),
                ('due_after_months', models.PositiveIntegerField(blank=True, help_text='Optional interval in months after which this service is due.', null=True)),
                ('show_on_customer_portal', models.BooleanField(default=False, help_text='Display this service as a column in the customer vehicle list.')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'ordering': ['job_name__name', 'name'],
            },
        ),
        migrations.CreateModel(
            name='StorefrontHeroShowcase',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('gradient_theme', models.CharField(choices=[('sky', 'Sky Blue'), ('sunrise', 'Sunrise Glow'), ('mint', 'Mint Breeze'), ('sand', 'Soft Sand'), ('ice', 'Icy Light')], default='sky', max_length=20)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='storefront_hero_showcase', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Storefront hero showcase',
                'verbose_name_plural': 'Storefront hero showcases',
            },
        ),
        migrations.CreateModel(
            name='Supplier',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=150)),
                ('contact_person', models.CharField(blank=True, max_length=150, null=True)),
                ('email', models.EmailField(blank=True, max_length=254, null=True)),
                ('phone_number', models.CharField(blank=True, max_length=20, null=True)),
                ('address', models.TextField(blank=True, null=True)),
                ('portal_user', models.OneToOneField(blank=True, help_text='Login account for this supplier', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='supplier_portal', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='suppliers', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='SupplierCheque',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('supplier_name', models.CharField(blank=True, max_length=150)),
                ('cheque_number', models.CharField(max_length=30)),
                ('bank_account', models.CharField(blank=True, max_length=120)),
                ('date', models.DateField(default=django.utils.timezone.localdate)),
                ('memo', models.TextField(blank=True, null=True)),
                ('status', models.CharField(choices=[('issued', 'Issued'), ('void', 'Void')], default='issued', max_length=10)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('supplier', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='cheques', to='accounts.supplier')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='SupplierCredit',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('supplier_name', models.CharField(blank=True, max_length=150)),
                ('credit_no', models.CharField(blank=True, max_length=20, null=True, unique=True)),
                ('date', models.DateField(null=True)),
                ('memo', models.TextField(blank=True, null=True)),
                ('tax_included', models.BooleanField(default=False)),
                ('province', models.CharField(blank=True, choices=[('AB', 'Alberta'), ('BC', 'British Columbia'), ('MB', 'Manitoba'), ('NB', 'New Brunswick'), ('NL', 'Newfoundland and Labrador'), ('NT', 'Northwest Territories'), ('NS', 'Nova Scotia'), ('NU', 'Nunavut'), ('ON', 'Ontario'), ('PE', 'Prince Edward Island'), ('QC', 'Quebec'), ('SK', 'Saskatchewan'), ('YT', 'Yukon'), ('CU', 'Custom')], max_length=2, null=True)),
                ('custom_tax_rate', models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ('record_in_inventory', models.BooleanField(default=True, help_text='When enabled, credit items adjust inventory stock levels.')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('supplier', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='credits', to='accounts.supplier')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Tag',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=50)),
            ],
        ),
        migrations.CreateModel(
            name='Timesheet',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('period_start', models.DateField()),
                ('period_end', models.DateField()),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('submitted', 'Submitted'), ('approved', 'Approved')], default='draft', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_timesheets', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_timesheets', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='timesheets', to='accounts.employee')),
            ],
        ),
        migrations.CreateModel(
            name='TransportDriver',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('employee_id', models.CharField(blank=True, max_length=50, null=True)),
                ('first_name', models.CharField(max_length=50)),
                ('last_name', models.CharField(max_length=50)),
                ('phone', models.CharField(max_length=20)),
                ('email', models.EmailField(blank=True, max_length=254, null=True)),
                ('address', models.TextField()),
                ('license_number', models.CharField(max_length=50)),
                ('license_state', models.CharField(max_length=2)),
                ('license_class', models.CharField(default='CDL-A', max_length=10)),
                ('license_expiry', models.DateField()),
                ('hire_date', models.DateField()),
                ('employment_status', models.CharField(choices=[('active', 'Active'), ('inactive', 'Inactive'), ('terminated', 'Terminated'), ('on_leave', 'On Leave')], default='active', max_length=20)),
                ('pay_type', models.CharField(choices=[('per_mile', 'Per Mile'), ('percentage', 'Percentage'), ('hourly', 'Hourly'), ('salary', 'Salary'), ('per_load', 'Per Load')], default='per_mile', max_length=20)),
                ('pay_rate', models.DecimalField(decimal_places=4, max_digits=8)),
                ('medical_expiry', models.DateField(blank=True, null=True)),
                ('drug_test_date', models.DateField(blank=True, null=True)),
                ('background_check_date', models.DateField(blank=True, null=True)),
                ('emergency_contact_name', models.CharField(blank=True, max_length=100, null=True)),
                ('emergency_contact_phone', models.CharField(blank=True, max_length=20, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transport_drivers', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='TransportOrder',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('order_number', models.CharField(max_length=32)),
                ('reference_no', models.CharField(blank=True, max_length=64, null=True)),
                ('origin', models.CharField(blank=True, max_length=255, null=True)),
                ('destination', models.CharField(blank=True, max_length=255, null=True)),
                ('commodity', models.CharField(blank=True, max_length=255, null=True)),
                ('weight_kg', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('volume_cbm', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('rate_type', models.CharField(choices=[('flat', 'Flat'), ('hourly', 'Hourly'), ('per_mile', 'Per Mile'), ('per_km', 'Per KM'), ('per_ton', 'Per Ton'), ('per_load', 'Per Load')], default='flat', max_length=16)),
                ('rate', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('planned_quantity', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('fuel_surcharge_pct', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('other_surcharges', models.TextField(blank=True, null=True)),
                ('pickup_window_start', models.DateTimeField(blank=True, null=True)),
                ('pickup_window_end', models.DateTimeField(blank=True, null=True)),
                ('delivery_window_start', models.DateTimeField(blank=True, null=True)),
                ('delivery_window_end', models.DateTimeField(blank=True, null=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('active', 'Active'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='active', max_length=16)),
                ('invoice_on_trip_completion', models.BooleanField(default=True)),
                ('attachment', models.FileField(blank=True, null=True, upload_to='order_attachments/')),
                ('customer', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transport_orders', to='accounts.customer')),
                ('linked_invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transport_orders', to='accounts.groupedinvoice')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transport_orders', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Vehicle',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('unit_number', models.CharField(blank=True, max_length=64, null=True, verbose_name='Unit Number')),
                ('vin_number', models.CharField(blank=True, db_index=True, max_length=17, null=True, verbose_name='VIN Number')),
                ('make_model', models.CharField(blank=True, max_length=50, null=True, verbose_name='Make and Model')),
                ('year', models.PositiveIntegerField(blank=True, null=True, verbose_name='Year')),
                ('license_plate', models.CharField(blank=True, max_length=20, null=True, verbose_name='License Plate')),
                ('status', models.CharField(blank=True, choices=[('active', 'Active'), ('maintenance', 'In Maintenance'), ('out_of_service', 'Out of Service'), ('retired', 'Retired')], default='active', max_length=20, verbose_name='Status')),
                ('start_date_in_service', models.DateField(blank=True, null=True, verbose_name='Start Date In Service')),
                ('assigned_to', models.CharField(blank=True, max_length=100, null=True, verbose_name='Department/Assigned To')),
                ('current_mileage', models.PositiveIntegerField(blank=True, help_text='Latest recorded mileage for the vehicle', null=True, verbose_name='Current Mileage')),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='vehicles', to='accounts.customer', verbose_name='Associated Customer')),
            ],
            options={
                'verbose_name': 'Vehicle',
                'verbose_name_plural': 'Vehicles',
                'ordering': ['customer', 'vin_number'],
            },
        ),
        migrations.CreateModel(
            name='WorkOrder',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date_created', models.DateTimeField(auto_now_add=True)),
                ('scheduled_date', models.DateField()),
                ('vehicle_vin', models.CharField(blank=True, max_length=17, null=True)),
                ('mileage', models.FloatField(blank=True, null=True)),
                ('unit_no', models.CharField(blank=True, max_length=64, null=True)),
                ('make_model', models.CharField(blank=True, max_length=50, null=True)),
                ('license_plate', models.CharField(blank=True, max_length=20, null=True)),
                ('description', models.TextField(blank=True, help_text='General description of the work order', null=True)),
                ('road_service', models.BooleanField(default=False)),
                ('road_location', models.CharField(blank=True, max_length=255, null=True)),
                ('road_location_lat', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True)),
                ('road_location_lng', models.DecimalField(blank=True, decimal_places=6, max_digits=9, null=True)),
                ('road_contact_phone', models.CharField(blank=True, max_length=32, null=True)),
                ('cause', models.TextField(blank=True, help_text='Cause of the issue.', null=True)),
                ('correction', models.TextField(blank=True, help_text='Correction performed.', null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='pending', max_length=15)),
                ('mechanic_status', models.CharField(choices=[('not_started', 'Not Started'), ('in_progress', 'In Progress'), ('paused', 'Paused'), ('travel', 'Traveling'), ('marked_complete', 'Marked Complete')], default='not_started', max_length=16)),
                ('bill_to', models.CharField(blank=True, max_length=100, null=True)),
                ('bill_to_email', models.EmailField(blank=True, max_length=254, null=True)),
                ('bill_to_address', models.TextField(blank=True, null=True)),
                ('mechanic_started_at', models.DateTimeField(blank=True, null=True)),
                ('mechanic_ended_at', models.DateTimeField(blank=True, null=True)),
                ('mechanic_paused_at', models.DateTimeField(blank=True, null=True)),
                ('mechanic_total_paused_seconds', models.PositiveIntegerField(default=0)),
                ('mechanic_pause_reason', models.TextField(blank=True, null=True)),
                ('mechanic_pause_log', models.JSONField(blank=True, default=list)),
                ('mechanic_travel_started_at', models.DateTimeField(blank=True, null=True)),
                ('mechanic_total_travel_seconds', models.PositiveIntegerField(default=0)),
                ('mechanic_marked_complete', models.BooleanField(default=False)),
                ('mechanic_completed_at', models.DateTimeField(blank=True, null=True)),
                ('signature_file', models.FileField(blank=True, null=True, upload_to='pods/')),
                ('media_files', models.JSONField(blank=True, default=list, help_text='List of media file paths uploaded by mechanic')),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('customer', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='work_orders', to='accounts.customer')),
                ('invoice', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='work_order', to='accounts.groupedinvoice')),
            ],
        ),
        migrations.CreateModel(
            name='WorkOrderUpdate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(max_length=32)),
                ('notes', models.TextField(blank=True)),
                ('latitude', models.FloatField(blank=True, null=True)),
                ('longitude', models.FloatField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('work_order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='updates', to='accounts.workorder')),
            ],
        ),
        migrations.CreateModel(
            name='WorkOrderRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('job', models.CharField(blank=True, max_length=2000)),
                ('qty', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('rate', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), editable=False, max_digits=12)),
                ('date', models.DateField(blank=True, null=True)),
                ('ticket', models.CharField(blank=True, max_length=16, null=True)),
                ('jobsite', models.CharField(blank=True, max_length=16, null=True)),
                ('truck', models.CharField(blank=True, max_length=16, null=True)),
                ('driver', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounts.driver')),
                ('product', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounts.product')),
                ('work_order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='records', to='accounts.workorder')),
            ],
        ),
        migrations.CreateModel(
            name='WorkOrderPhoto',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('photo', models.FileField(upload_to='workorder_photos/')),
                ('caption', models.CharField(blank=True, max_length=255)),
                ('latitude', models.FloatField(blank=True, null=True)),
                ('longitude', models.FloatField(blank=True, null=True)),
                ('work_order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='photos', to='accounts.workorder')),
            ],
        ),
        migrations.CreateModel(
            name='WorkOrderAssignment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('assignment_token', models.CharField(editable=False, max_length=64, unique=True)),
                ('submitted', models.BooleanField(default=False)),
                ('date_assigned', models.DateTimeField(auto_now_add=True)),
                ('date_submitted', models.DateTimeField(blank=True, editable=False, null=True)),
                ('requires_rework', models.BooleanField(default=False)),
                ('rework_instructions', models.TextField(blank=True)),
                ('rework_requested_at', models.DateTimeField(blank=True, null=True)),
                ('mechanic', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='assignments', to='accounts.mechanic')),
                ('workorder', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='assignments', to='accounts.workorder')),
            ],
            options={
                'unique_together': {('workorder', 'mechanic')},
            },
        ),
        migrations.AddField(
            model_name='workorder',
            name='mechanics',
            field=models.ManyToManyField(blank=True, related_name='assigned_workorders', through='accounts.WorkOrderAssignment', to='accounts.mechanic'),
        ),
        migrations.AddField(
            model_name='workorder',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='workorder',
            name='vehicle',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='work_orders', to='accounts.vehicle'),
        ),
        migrations.CreateModel(
            name='VehicleServicePortalOverride',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('last_service_date', models.DateField(blank=True, null=True)),
                ('last_service_mileage', models.PositiveIntegerField(blank=True, null=True)),
                ('next_service_date', models.DateField(blank=True, null=True)),
                ('next_service_mileage', models.PositiveIntegerField(blank=True, null=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('service', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='vehicle_portal_overrides', to='accounts.service')),
                ('vehicle', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='service_portal_overrides', to='accounts.vehicle')),
            ],
        ),
        migrations.CreateModel(
            name='VehicleMaintenanceTask',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=120)),
                ('description', models.TextField(blank=True)),
                ('due_date', models.DateField(blank=True, null=True)),
                ('due_mileage', models.PositiveIntegerField(blank=True, null=True)),
                ('mileage_interval', models.PositiveIntegerField(blank=True, help_text='Mileage interval for recurring maintenance reminders.', null=True)),
                ('priority', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High')], default='medium', max_length=10)),
                ('status', models.CharField(choices=[('planned', 'Planned'), ('scheduled', 'Scheduled'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], db_index=True, default='planned', max_length=20)),
                ('completed_date', models.DateField(blank=True, null=True)),
                ('actual_mileage', models.PositiveIntegerField(blank=True, null=True)),
                ('completion_notes', models.TextField(blank=True)),
                ('last_reminder_sent', models.DateTimeField(blank=True, help_text='Timestamp of the last maintenance reminder email sent for this task.', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('grouped_invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='maintenance_tasks', to='accounts.groupedinvoice')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='maintenance_tasks', to=settings.AUTH_USER_MODEL)),
                ('vehicle', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='maintenance_tasks', to='accounts.vehicle')),
                ('work_order', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='maintenance_tasks', to='accounts.workorder')),
            ],
            options={
                'verbose_name': 'Vehicle Maintenance Task',
                'verbose_name_plural': 'Vehicle Maintenance Tasks',
                'ordering': ['status', 'due_date', 'priority', 'title'],
            },
        ),
        migrations.CreateModel(
            name='UserStripeAccount',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('stripe_account_id', models.CharField(blank=True, max_length=255, null=True)),
                ('is_verified', models.BooleanField(default=False)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Trip',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField(default=django.utils.timezone.now)),
                ('status', models.CharField(choices=[('planned', 'Planned'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='planned', max_length=16)),
                ('odometer_start', models.PositiveIntegerField(blank=True, null=True)),
                ('odometer_end', models.PositiveIntegerField(blank=True, null=True)),
                ('distance', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('hours_worked', models.DecimalField(blank=True, decimal_places=2, max_digits=8, null=True)),
                ('start_at', models.DateTimeField(blank=True, null=True)),
                ('end_at', models.DateTimeField(blank=True, null=True)),
                ('origin_override', models.CharField(blank=True, max_length=255, null=True)),
                ('destination_override', models.CharField(blank=True, max_length=255, null=True)),
                ('route_summary', models.TextField(blank=True, null=True)),
                ('revenue_rate_type_snapshot', models.CharField(blank=True, choices=[('flat', 'Flat'), ('hourly', 'Hourly'), ('per_mile', 'Per Mile'), ('per_km', 'Per KM'), ('per_ton', 'Per Ton'), ('per_load', 'Per Load')], max_length=16, null=True)),
                ('revenue_rate_snapshot', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('revenue_qty_snapshot', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('computed_amount_snapshot', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('computed_tax_snapshot', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('pod_file', models.FileField(blank=True, null=True, upload_to='pods/')),
                ('other_docs', models.FileField(blank=True, null=True, upload_to='trip_docs/')),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('driver', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounts.driver')),
                ('invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='trips', to='accounts.groupedinvoice')),
                ('order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='trips', to='accounts.transportorder')),
                ('vehicle', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounts.fleetvehicle')),
            ],
        ),
        migrations.CreateModel(
            name='TransportVehicle',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('unit_number', models.CharField(max_length=64)),
                ('vin', models.CharField(blank=True, max_length=17, null=True)),
                ('make', models.CharField(max_length=50)),
                ('model', models.CharField(max_length=50)),
                ('year', models.IntegerField()),
                ('vehicle_type', models.CharField(choices=[('truck', 'Truck'), ('trailer', 'Trailer'), ('van', 'Van'), ('flatbed', 'Flatbed'), ('tanker', 'Tanker'), ('refrigerated', 'Refrigerated')], max_length=30)),
                ('max_weight', models.DecimalField(decimal_places=2, max_digits=10)),
                ('max_length', models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True)),
                ('max_width', models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True)),
                ('max_height', models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True)),
                ('license_plate', models.CharField(blank=True, max_length=20, null=True)),
                ('registration_state', models.CharField(blank=True, max_length=2, null=True)),
                ('insurance_policy', models.CharField(blank=True, max_length=100, null=True)),
                ('status', models.CharField(choices=[('active', 'Active'), ('maintenance', 'In Maintenance'), ('out_of_service', 'Out of Service'), ('retired', 'Retired')], default='active', max_length=20)),
                ('current_location', models.CharField(blank=True, max_length=200, null=True)),
                ('last_maintenance', models.DateField(blank=True, null=True)),
                ('next_maintenance', models.DateField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transport_vehicles', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='TransportTrip',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('trip_number', models.CharField(max_length=50, unique=True)),
                ('load_number', models.CharField(blank=True, max_length=50, null=True)),
                ('origin_address', models.TextField()),
                ('origin_city', models.CharField(max_length=100)),
                ('origin_state', models.CharField(max_length=2)),
                ('origin_zip', models.CharField(max_length=10)),
                ('destination_address', models.TextField()),
                ('destination_city', models.CharField(max_length=100)),
                ('destination_state', models.CharField(max_length=2)),
                ('destination_zip', models.CharField(max_length=10)),
                ('pickup_date', models.DateTimeField()),
                ('delivery_date', models.DateTimeField()),
                ('actual_pickup', models.DateTimeField(blank=True, null=True)),
                ('actual_delivery', models.DateTimeField(blank=True, null=True)),
                ('commodity', models.CharField(max_length=200)),
                ('weight', models.DecimalField(decimal_places=2, max_digits=10)),
                ('pieces', models.IntegerField(default=1)),
                ('freight_class', models.CharField(blank=True, max_length=10, null=True)),
                ('total_rate', models.DecimalField(decimal_places=2, max_digits=10)),
                ('fuel_surcharge', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('accessorial_charges', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('status', models.CharField(choices=[('dispatched', 'Dispatched'), ('en_route_pickup', 'En Route to Pickup'), ('at_pickup', 'At Pickup'), ('loaded', 'Loaded'), ('en_route_delivery', 'En Route to Delivery'), ('at_delivery', 'At Delivery'), ('delivered', 'Delivered'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='dispatched', max_length=20)),
                ('total_miles', models.DecimalField(blank=True, decimal_places=2, max_digits=8, null=True)),
                ('driving_hours', models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True)),
                ('bol_number', models.CharField(blank=True, max_length=50, null=True)),
                ('po_number', models.CharField(blank=True, max_length=50, null=True)),
                ('pro_number', models.CharField(blank=True, max_length=50, null=True)),
                ('special_instructions', models.TextField(blank=True, null=True)),
                ('driver_notes', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transport_trips', to='accounts.customer')),
                ('driver', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounts.transportdriver')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transport_trips', to=settings.AUTH_USER_MODEL)),
                ('vehicle', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounts.transportvehicle')),
            ],
        ),
        migrations.CreateModel(
            name='TransportProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('company_name', models.CharField(max_length=200)),
                ('dot_number', models.CharField(blank=True, help_text='DOT Number', max_length=50, null=True)),
                ('mc_number', models.CharField(blank=True, help_text='MC Number', max_length=50, null=True)),
                ('scac_code', models.CharField(blank=True, help_text='SCAC Code', max_length=10, null=True)),
                ('operating_authority', models.CharField(blank=True, max_length=100, null=True)),
                ('insurance_company', models.CharField(blank=True, max_length=200, null=True)),
                ('insurance_policy', models.CharField(blank=True, max_length=100, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='transport_profile', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='TransportInvoice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('billing_type', models.CharField(choices=[('per_load', 'Per Load'), ('consolidated', 'Consolidated'), ('weekly', 'Weekly'), ('monthly', 'Monthly')], default='per_load', max_length=20)),
                ('total_loads', models.IntegerField(default=0, editable=False)),
                ('total_miles', models.DecimalField(decimal_places=2, default=0, editable=False, max_digits=10)),
                ('total_weight', models.DecimalField(decimal_places=2, default=0, editable=False, max_digits=12)),
                ('line_haul', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('fuel_surcharge', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('accessorial_total', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('grouped_invoice', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='transport_data', to='accounts.groupedinvoice')),
                ('trips', models.ManyToManyField(related_name='invoices', to='accounts.transporttrip')),
            ],
        ),
        migrations.CreateModel(
            name='TransportCustomer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_type', models.CharField(choices=[('shipper', 'Shipper'), ('consignee', 'Consignee'), ('broker', 'Broker'), ('both', 'Shipper/Consignee')], default='shipper', max_length=20)),
                ('dispatch_phone', models.CharField(blank=True, max_length=20, null=True)),
                ('dispatch_email', models.EmailField(blank=True, max_length=254, null=True)),
                ('billing_contact', models.CharField(blank=True, max_length=100, null=True)),
                ('duns_number', models.CharField(blank=True, max_length=20, null=True)),
                ('freight_class', models.CharField(blank=True, max_length=10, null=True)),
                ('special_instructions', models.TextField(blank=True, null=True)),
                ('payment_terms_days', models.IntegerField(default=30)),
                ('credit_limit', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('customer', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='transport_data', to='accounts.customer')),
            ],
        ),
        migrations.CreateModel(
            name='TimesheetSnapshot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('source', models.CharField(choices=[('mechanic', 'Mechanic submission'), ('admin', 'Admin record')], max_length=20)),
                ('captured_at', models.DateTimeField(auto_now=True)),
                ('total_hours', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=6)),
                ('entries', models.JSONField(default=list)),
                ('submitted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='timesheet_snapshots', to=settings.AUTH_USER_MODEL)),
                ('timesheet', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='snapshots', to='accounts.timesheet')),
            ],
        ),
        migrations.CreateModel(
            name='TimeEntry',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('work_date', models.DateField()),
                ('start_time', models.TimeField(blank=True, null=True)),
                ('end_time', models.TimeField(blank=True, null=True)),
                ('hours', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=6)),
                ('notes', models.CharField(blank=True, max_length=255)),
                ('timesheet', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='entries', to='accounts.timesheet')),
            ],
        ),
        migrations.CreateModel(
            name='TaxExemptionReason',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('reason', models.CharField(max_length=255)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tax_exemption_reasons', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='SupplierCreditItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('part_no', models.CharField(blank=True, max_length=50, null=True)),
                ('description', models.TextField(blank=True, null=True)),
                ('qty', models.FloatField(default=1)),
                ('price', models.FloatField(default=0)),
                ('amount', models.FloatField(default=0, editable=False)),
                ('tax_paid', models.FloatField(default=0, editable=False)),
                ('product', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='supplier_credit_items', to='accounts.product')),
                ('source_expense', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='supplier_credit_items', to='accounts.mechexpense')),
                ('source_expense_item', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='supplier_credit_items', to='accounts.mechexpenseitem')),
                ('supplier_credit', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='accounts.suppliercredit')),
            ],
            options={
                'verbose_name': 'Supplier Credit Item',
                'verbose_name_plural': 'Supplier Credit Items',
            },
        ),
        migrations.CreateModel(
            name='SupplierChequeLine',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('amount', models.DecimalField(decimal_places=2, max_digits=10)),
                ('memo', models.TextField(blank=True, null=True)),
                ('cheque', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lines', to='accounts.suppliercheque')),
                ('mech_expense', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='cheque_lines', to='accounts.mechexpense')),
            ],
        ),
        migrations.CreateModel(
            name='StorefrontMessageBanner',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_active', models.BooleanField(default=False)),
                ('message', models.CharField(blank=True, max_length=240)),
                ('link_text', models.CharField(blank=True, max_length=80)),
                ('link_url', models.CharField(blank=True, max_length=200)),
                ('theme', models.CharField(choices=[('sky', 'Sky Blue'), ('sunrise', 'Sunrise Glow'), ('mint', 'Mint Breeze'), ('sand', 'Soft Sand'), ('ice', 'Icy Light')], default='sunrise', max_length=20)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='storefront_message_banner', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Storefront message banner',
                'verbose_name_plural': 'Storefront message banners',
            },
        ),
        migrations.CreateModel(
            name='StorefrontHeroShowcaseItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('discount_percent', models.PositiveSmallIntegerField(blank=True, help_text='Optional discount badge shown on the hero slide.', null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(100)])),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('hero', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='slides', to='accounts.storefrontheroshowcase')),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='hero_showcase_items', to='accounts.product')),
            ],
            options={
                'ordering': ['id'],
            },
        ),
        migrations.CreateModel(
            name='StorefrontHeroPackage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=120)),
                ('subtitle', models.CharField(blank=True, max_length=200)),
                ('discount_percent', models.PositiveSmallIntegerField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('free_product', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='hero_package_free', to='accounts.product')),
                ('primary_product', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='hero_package_primary', to='accounts.product')),
                ('secondary_product', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='hero_package_secondary', to='accounts.product')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='storefront_hero_packages', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Storefront hero package',
                'verbose_name_plural': 'Storefront hero packages',
                'ordering': ['id'],
            },
        ),
        migrations.CreateModel(
            name='ShiftTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=120)),
                ('start_time', models.TimeField()),
                ('end_time', models.TimeField()),
                ('notes', models.CharField(blank=True, max_length=255)),
                ('active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='shift_templates', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='ServiceJobName',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='service_job_names', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='ServiceDescription',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('description', models.TextField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('usage_count', models.PositiveIntegerField(default=0)),
                ('service', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='additional_descriptions', to='accounts.service')),
            ],
            options={
                'ordering': ['-usage_count', '-created_at'],
            },
        ),
        migrations.AddField(
            model_name='service',
            name='job_name',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='services', to='accounts.servicejobname'),
        ),
        migrations.AddField(
            model_name='service',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='services', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='ReminderLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('sent_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reminder_logs', to='accounts.customer')),
            ],
            options={
                'ordering': ['-sent_at'],
            },
        ),
        migrations.CreateModel(
            name='QuickBooksSettings',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('integration_type', models.CharField(choices=[('online', 'QuickBooks Online'), ('desktop', 'QuickBooks Desktop')], default='online', max_length=20)),
                ('client_id', models.CharField(blank=True, max_length=200)),
                ('client_secret', models.CharField(blank=True, max_length=200)),
                ('realm_id', models.CharField(blank=True, help_text='QuickBooks company (realm) identifier.', max_length=100)),
                ('redirect_uri', models.URLField(blank=True, help_text='OAuth redirect URI registered with your QuickBooks app.')),
                ('environment', models.CharField(choices=[('sandbox', 'Sandbox'), ('production', 'Production')], default='sandbox', max_length=12)),
                ('refresh_token', models.CharField(blank=True, help_text='Paste the refresh token from the QuickBooks developer portal.', max_length=500, null=True)),
                ('access_token', models.CharField(blank=True, max_length=500, null=True)),
                ('access_token_expires_at', models.DateTimeField(blank=True, null=True)),
                ('last_synced_at', models.DateTimeField(blank=True, null=True)),
                ('last_sync_status', models.CharField(blank=True, max_length=255, null=True)),
                ('auto_sync_enabled', models.BooleanField(default=False)),
                ('desktop_company_name', models.CharField(blank=True, help_text='Company name exactly as it appears in QuickBooks Desktop.', max_length=255)),
                ('desktop_last_exported_at', models.DateTimeField(blank=True, null=True)),
                ('desktop_last_export_filename', models.CharField(blank=True, max_length=255)),
                ('desktop_last_imported_at', models.DateTimeField(blank=True, null=True)),
                ('desktop_last_import_filename', models.CharField(blank=True, max_length=255)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='quickbooks_settings', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'QuickBooks Integration',
                'verbose_name_plural': 'QuickBooks Integrations',
            },
        ),
        migrations.CreateModel(
            name='QuickBooksImportMap',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('object_type', models.CharField(max_length=32)),
                ('qbo_id', models.CharField(max_length=64)),
                ('local_app_label', models.CharField(max_length=64)),
                ('local_model_name', models.CharField(max_length=64)),
                ('local_object_id', models.PositiveIntegerField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='qbo_import_maps', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='QuickBooksConnection',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('realm_id', models.TextField()),
                ('access_token', models.TextField()),
                ('refresh_token', models.TextField()),
                ('access_token_expires_at', models.DateTimeField()),
                ('refresh_token_expires_at', models.DateTimeField()),
                ('env', models.CharField(choices=[('sandbox', 'Sandbox'), ('production', 'Production')], default='sandbox', max_length=16)),
                ('last_sync_at', models.DateTimeField(blank=True, null=True)),
                ('sync_customers_on_create', models.BooleanField(default=False)),
                ('sync_invoices_on_create', models.BooleanField(default=False)),
                ('sync_estimates_on_create', models.BooleanField(default=False)),
                ('sync_payments_on_create', models.BooleanField(default=False)),
                ('sync_expenses_on_create', models.BooleanField(default=False)),
                ('sync_invoice_on_workorder_completion', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='qbo_connection', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'QuickBooks Connection',
                'verbose_name_plural': 'QuickBooks Connections',
            },
        ),
        migrations.CreateModel(
            name='PublicContactMessage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('full_name', models.CharField(max_length=120)),
                ('email', models.EmailField(max_length=254)),
                ('phone', models.CharField(blank=True, max_length=20, null=True)),
                ('company', models.CharField(blank=True, max_length=120, null=True)),
                ('service_type', models.CharField(blank=True, choices=[('engine', 'Engine Diagnostics & Repair'), ('transmission', 'Transmission Services'), ('brakes', 'Brake System Services'), ('electrical', 'Electrical Systems'), ('dpf', 'DPF & Emissions Service'), ('maintenance', 'Preventive Maintenance'), ('dot', 'DriveON (MTO) Inspections'), ('emergency', 'Emergency Service'), ('other', 'Other')], max_length=32, null=True)),
                ('subject', models.CharField(blank=True, max_length=255)),
                ('message_type', models.CharField(choices=[('general', 'General inquiry'), ('support', 'Account support'), ('invoice', 'Invoice question'), ('maintenance', 'Maintenance / service'), ('other', 'Other')], default='general', max_length=32)),
                ('reference_code', models.CharField(blank=True, max_length=120)),
                ('message', models.TextField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('status', models.CharField(choices=[('new', 'New'), ('seen', 'Seen')], default='new', max_length=20)),
                ('source', models.CharField(choices=[('public', 'Public Website'), ('portal', 'Customer Portal')], default='public', max_length=20)),
                ('customer', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contact_messages', to='accounts.customer')),
                ('submitted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='submitted_contact_messages', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Profile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_business_admin', models.BooleanField(default=False, help_text='Designates this profile as a member of the business staff.')),
                ('admin_approved', models.BooleanField(default=False, help_text='Indicates whether the staff account has been approved.')),
                ('stripe_terminal_location_id', models.CharField(blank=True, help_text='Stores Stripe Terminal Location ID for this users connected account', max_length=255, null=True)),
                ('terminal_enabled', models.BooleanField(default=False, help_text='Allow in-person payments via Stripe Terminal')),
                ('send_payment_link_email', models.BooleanField(default=True, help_text='Toggle whether the system should include an online payment link in outgoing emails.', verbose_name='Email payment link on invoice')),
                ('payment_link_provider', models.CharField(choices=[('stripe', 'Stripe'), ('clover', 'Clover'), ('none', 'None')], default='stripe', help_text='Select which provider to use when generating online payment links.', max_length=20)),
                ('company_name', models.CharField(blank=True, max_length=100, null=True)),
                ('storefront_display_name', models.CharField(blank=True, help_text='Optional name shown to customers when selecting a store location.', max_length=120, null=True)),
                ('company_address', models.TextField(blank=True, null=True)),
                ('company_email', models.EmailField(blank=True, max_length=254, null=True)),
                ('company_phone', models.TextField(blank=True, null=True)),
                ('company_fax', models.CharField(blank=True, max_length=50, null=True)),
                ('accountant_name', models.CharField(blank=True, max_length=100, null=True)),
                ('accountant_firm', models.CharField(blank=True, max_length=120, null=True)),
                ('accountant_email', models.EmailField(blank=True, max_length=254, null=True)),
                ('accountant_phone', models.CharField(blank=True, max_length=50, null=True)),
                ('accountant_access_level', models.CharField(blank=True, choices=[('full', 'Full access'), ('reports', 'Reports only'), ('read_only', 'Read only')], default='reports', max_length=20)),
                ('accountant_timezone', models.CharField(blank=True, max_length=50, null=True)),
                ('gst_hst_number', models.CharField(blank=True, max_length=50, null=True)),
                ('wsib_number', models.CharField(blank=True, max_length=50, null=True)),
                ('company_logo', models.ImageField(blank=True, null=True, upload_to='company_logos/')),
                ('term', models.CharField(choices=[('due_on_receipt', 'Due on Receipt'), ('net_2', 'Due within 2 days'), ('net_7', 'Due within 7 days'), ('net_15', 'Due within 15 days'), ('net_30', 'Due within 30 days'), ('net_45', 'Due within 45 days')], default='net_30', help_text='Payment due in specified days or due on receipt', max_length=20)),
                ('show_note', models.BooleanField(default=True, help_text='Show note on the invoice')),
                ('note', models.TextField(blank=True, default='Please ensure payment is made within the specified period to avoid any potential overdue charges.', help_text='Custom note for the invoice', null=True)),
                ('invoice_sequence_next', models.PositiveIntegerField(blank=True, help_text='Next invoice sequence number. Leave blank to keep automatic numbering.', null=True)),
                ('use_dynamic_note', models.BooleanField(default=False, help_text='Use an AI-generated dynamic note instead of a custom note.')),
                ('occupation', models.CharField(choices=[('truck_mechanic', 'Truck Mechanic'), ('towing', 'Towing'), ('parts_store', 'Parts Store')], max_length=50)),
                ('street_address', models.CharField(blank=True, max_length=100, null=True)),
                ('city', models.CharField(blank=True, max_length=100, null=True)),
                ('province', models.CharField(choices=[('AB', 'Alberta'), ('BC', 'British Columbia'), ('MB', 'Manitoba'), ('NB', 'New Brunswick'), ('NL', 'Newfoundland and Labrador'), ('NT', 'Northwest Territories'), ('NS', 'Nova Scotia'), ('NU', 'Nunavut'), ('ON', 'Ontario'), ('PE', 'Prince Edward Island'), ('QC', 'Quebec'), ('SK', 'Saskatchewan'), ('YT', 'Yukon'), ('CU', 'Custom')], default='ON', max_length=2)),
                ('postal_code', models.CharField(blank=True, max_length=10, null=True)),
                ('invoice_header_color', models.CharField(default='#007bff', max_length=7)),
                ('invoice_font_size', models.IntegerField(default=16)),
                ('show_logo', models.BooleanField(default=True)),
                ('show_address', models.BooleanField(default=True)),
                ('ui_scale_percentage', models.PositiveIntegerField(choices=[(150, 'Maximum (150%)'), (120, 'Extra Large (120%)'), (110, 'Large (110%)'), (100, 'Default (100%)'), (95, 'Comfortable (95%)'), (90, 'Compact (90%)'), (85, 'Extra Compact (85%)'), (80, 'Ultra Compact (80%)'), (75, 'Tighter (75%)'), (70, 'Micro (70%)'), (65, 'Mini (65%)'), (60, 'Minimum (60%)')], default=100, help_text='Controls how much the portal and dashboard interfaces should be scaled.')),
                ('ui_scale_public_percentage', models.PositiveIntegerField(choices=[(150, 'Maximum (150%)'), (120, 'Extra Large (120%)'), (110, 'Large (110%)'), (100, 'Default (100%)'), (95, 'Comfortable (95%)'), (90, 'Compact (90%)'), (85, 'Extra Compact (85%)'), (80, 'Ultra Compact (80%)'), (75, 'Tighter (75%)'), (70, 'Micro (70%)'), (65, 'Mini (65%)'), (60, 'Minimum (60%)')], default=100, help_text='Controls how much the public website pages should be scaled.')),
                ('storefront_show_prices_hero', models.BooleanField(default=False, help_text='Show prices to guests in the homepage hero section.')),
                ('storefront_show_prices_featured', models.BooleanField(default=False, help_text='Show prices to guests in featured product sections.')),
                ('storefront_show_prices_catalog', models.BooleanField(default=False, help_text='Show prices to guests across product listings and details.')),
                ('qr_code_font_scale', models.PositiveIntegerField(default=100, help_text='Scale percentage used to adjust QR code label font sizes.')),
                ('qr_show_name', models.BooleanField(default=True, help_text='Display the product name on generated QR code labels.')),
                ('qr_show_description', models.BooleanField(default=True, help_text='Display the product description on generated QR code labels.')),
                ('qr_show_sku', models.BooleanField(default=True, help_text='Display the product SKU on generated QR code labels.')),
                ('default_inventory_margin_percent', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Default profit margin percentage applied to inventory sale prices.', max_digits=5)),
                ('trial_start_date', models.DateTimeField(blank=True, null=True)),
                ('trial_end_date', models.DateTimeField(blank=True, null=True)),
                ('stripe_customer_id', models.CharField(blank=True, max_length=255, null=True)),
                ('stripe_subscription_id', models.CharField(blank=True, max_length=255, null=True)),
                ('deactivation_date', models.DateTimeField(blank=True, null=True)),
                ('consent_given', models.BooleanField(default=False)),
                ('consent_date', models.DateTimeField(blank=True, null=True)),
                ('consent_version', models.CharField(blank=True, max_length=10, null=True)),
                ('activation_link_clicked', models.BooleanField(default=False)),
                ('activation_date', models.DateTimeField(blank=True, null=True)),
                ('interact_email', models.EmailField(blank=True, help_text='This email is used for asking users for payments.', max_length=254, null=True)),
                ('qst_number', models.CharField(blank=True, help_text='Enter your QST number (e.g., 1234567890TQ0001) if your province is Quebec.', max_length=17, null=True, validators=[django.core.validators.RegexValidator(message="Invalid QST number format. Must be 10 digits followed by 'RP' and then 4 digits (e.g., 1234567890TQ0001).", regex='^\\d{10}RP\\d{4}$')])),
                ('accountant_portal_user', models.OneToOneField(blank=True, help_text='Login account for the accountant portal.', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='accountant_portal', to=settings.AUTH_USER_MODEL)),
                ('business_owner', models.ForeignKey(blank=True, help_text='Primary business account this profile belongs to.', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='team_profiles', to=settings.AUTH_USER_MODEL)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='ProductVin',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('vin', models.CharField(max_length=17)),
                ('description', models.TextField(blank=True, null=True)),
                ('sort_order', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='product_vins', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['sort_order', 'vin'],
            },
        ),
        migrations.CreateModel(
            name='ProductModel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=120)),
                ('description', models.TextField(blank=True, null=True)),
                ('year_start', models.PositiveIntegerField(blank=True, null=True)),
                ('year_end', models.PositiveIntegerField(blank=True, null=True)),
                ('sort_order', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('brand', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='models', to='accounts.productbrand')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='product_models', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['sort_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='ProductAttributeValue',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('value_text', models.CharField(blank=True, max_length=200)),
                ('value_number', models.DecimalField(blank=True, decimal_places=4, max_digits=12, null=True)),
                ('value_boolean', models.BooleanField(blank=True, null=True)),
                ('attribute', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='product_values', to='accounts.categoryattribute')),
                ('option', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='product_values', to='accounts.categoryattributeoption')),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attribute_values', to='accounts.product')),
            ],
        ),
        migrations.AddField(
            model_name='product',
            name='brand',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='products', to='accounts.productbrand'),
        ),
        migrations.AddField(
            model_name='product',
            name='category',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='products', to='accounts.category'),
        ),
        migrations.AddField(
            model_name='product',
            name='supplier',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='products', to='accounts.supplier'),
        ),
        migrations.AddField(
            model_name='product',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='products', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='product',
            name='vehicle_model',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='products', to='accounts.productmodel'),
        ),
        migrations.AddField(
            model_name='product',
            name='vin_number',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='products', to='accounts.productvin'),
        ),
        migrations.CreateModel(
            name='PMInspection',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('inspector_name', models.CharField(blank=True, max_length=255)),
                ('inspection_date', models.CharField(blank=True, max_length=64)),
                ('scheduled_date', models.CharField(blank=True, max_length=64)),
                ('business_snapshot', models.JSONField(blank=True, default=dict)),
                ('customer_name', models.CharField(blank=True, max_length=255)),
                ('location', models.TextField(blank=True)),
                ('vehicle_snapshot', models.JSONField(blank=True, default=dict)),
                ('checklist', models.JSONField(blank=True, default=dict)),
                ('additional_notes', models.TextField(blank=True)),
                ('overall_status', models.CharField(blank=True, choices=[('pass', 'Pass'), ('fail', 'Fail')], default='', help_text='Overall inspection result selected by the mechanic.', max_length=8)),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('assignment', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pm_inspections', to='accounts.workorderassignment')),
                ('workorder', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='pm_inspection', to='accounts.workorder')),
            ],
            options={
                'ordering': ('-updated_at',),
            },
        ),
        migrations.CreateModel(
            name='PendingInvoice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date_created', models.DateTimeField(auto_now_add=True)),
                ('is_paid', models.BooleanField(default=False)),
                ('grouped_invoice', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='pending_invoice', to='accounts.groupedinvoice')),
            ],
            options={
                'verbose_name': 'Pending Invoice',
                'verbose_name_plural': 'Pending Invoices',
            },
        ),
        migrations.CreateModel(
            name='PayStubLineItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('line_type', models.CharField(choices=[('earning', 'Earning'), ('deduction', 'Deduction'), ('benefit', 'Benefit'), ('employer_tax', 'Employer Tax')], max_length=20)),
                ('name', models.CharField(max_length=200)),
                ('amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('employer_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('paystub', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='line_items', to='accounts.paystub')),
            ],
        ),
        migrations.CreateModel(
            name='PayrollTaxBracket',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('jurisdiction', models.CharField(choices=[('FED', 'Federal'), ('AB', 'Alberta'), ('BC', 'British Columbia'), ('MB', 'Manitoba'), ('NB', 'New Brunswick'), ('NL', 'Newfoundland and Labrador'), ('NT', 'Northwest Territories'), ('NS', 'Nova Scotia'), ('NU', 'Nunavut'), ('ON', 'Ontario'), ('PE', 'Prince Edward Island'), ('QC', 'Quebec'), ('SK', 'Saskatchewan'), ('YT', 'Yukon'), ('CU', 'Custom')], max_length=3)),
                ('bracket_min', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('bracket_max', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('rate', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=6)),
                ('tax_year', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='brackets', to='accounts.payrolltaxyear')),
            ],
            options={
                'ordering': ['bracket_min'],
            },
        ),
        migrations.CreateModel(
            name='PayrollSettings',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('pay_period_frequency', models.CharField(choices=[('weekly', 'Weekly'), ('biweekly', 'Biweekly'), ('semimonthly', 'Semimonthly'), ('monthly', 'Monthly')], default='biweekly', max_length=16)),
                ('period_anchor_date', models.DateField(default=django.utils.timezone.now, help_text='Anchor date for pay period calculations.')),
                ('default_pay_date_offset_days', models.PositiveIntegerField(default=0, help_text='Days after period end to set pay date.')),
                ('auto_approve_timesheets', models.BooleanField(default=False)),
                ('overtime_enabled', models.BooleanField(default=False)),
                ('overtime_daily_enabled', models.BooleanField(default=True)),
                ('overtime_daily_threshold', models.DecimalField(decimal_places=2, default=Decimal('8.00'), max_digits=6)),
                ('overtime_weekly_enabled', models.BooleanField(default=True)),
                ('overtime_weekly_threshold', models.DecimalField(decimal_places=2, default=Decimal('40.00'), max_digits=6)),
                ('overtime_multiplier', models.DecimalField(decimal_places=2, default=Decimal('1.50'), max_digits=4)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='payroll_settings', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='PayrollProvinceTaxSetting',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('province', models.CharField(choices=[('AB', 'Alberta'), ('BC', 'British Columbia'), ('MB', 'Manitoba'), ('NB', 'New Brunswick'), ('NL', 'Newfoundland and Labrador'), ('NT', 'Northwest Territories'), ('NS', 'Nova Scotia'), ('NU', 'Nunavut'), ('ON', 'Ontario'), ('PE', 'Prince Edward Island'), ('QC', 'Quebec'), ('SK', 'Saskatchewan'), ('YT', 'Yukon'), ('CU', 'Custom')], max_length=2)),
                ('basic_personal_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('tax_year', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='province_settings', to='accounts.payrolltaxyear')),
            ],
        ),
        migrations.CreateModel(
            name='PayrollEmployerTax',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('province', models.CharField(choices=[('AB', 'Alberta'), ('BC', 'British Columbia'), ('MB', 'Manitoba'), ('NB', 'New Brunswick'), ('NL', 'Newfoundland and Labrador'), ('NT', 'Northwest Territories'), ('NS', 'Nova Scotia'), ('NU', 'Nunavut'), ('ON', 'Ontario'), ('PE', 'Prince Edward Island'), ('QC', 'Quebec'), ('SK', 'Saskatchewan'), ('YT', 'Yukon'), ('CU', 'Custom')], max_length=2)),
                ('name', models.CharField(max_length=120)),
                ('rate', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=6)),
                ('threshold', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=12)),
                ('max_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('applies_to_all', models.BooleanField(default=True)),
                ('tax_year', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='employer_taxes', to='accounts.payrolltaxyear')),
            ],
        ),
        migrations.CreateModel(
            name='Payment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField(blank=True, null=True)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=10)),
                ('method', models.CharField(blank=True, max_length=50, null=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('invoice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payments', to='accounts.groupedinvoice')),
            ],
        ),
        migrations.CreateModel(
            name='PaidInvoice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date_paid', models.DateTimeField(auto_now_add=True)),
                ('grouped_invoice', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='paid_invoice', to='accounts.groupedinvoice')),
            ],
            options={
                'verbose_name': 'Paid Invoice',
                'verbose_name_plural': 'Paid Invoices',
            },
        ),
        migrations.CreateModel(
            name='Note',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=255)),
                ('content', models.TextField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('pinned', models.BooleanField(default=False)),
                ('is_done', models.BooleanField(default=False)),
                ('order', models.IntegerField(default=0)),
                ('tags', models.ManyToManyField(blank=True, to='accounts.tag')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='MechExpensePayment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('amount', models.DecimalField(decimal_places=2, max_digits=10)),
                ('method', models.CharField(max_length=50)),
                ('notes', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('cheque', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='expense_payments', to='accounts.suppliercheque')),
                ('mech_expense', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payments', to='accounts.mechexpense')),
                ('recorded_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='recorded_expense_payments', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Expense Payment',
                'verbose_name_plural': 'Expense Payments',
            },
        ),
        migrations.CreateModel(
            name='MechanicSignupCode',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(max_length=32, unique=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('used', models.BooleanField(default=False)),
                ('business', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='mechanic_signup_codes', to=settings.AUTH_USER_MODEL)),
                ('mechanic', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='signup_code', to='accounts.mechanic')),
            ],
        ),
        migrations.CreateModel(
            name='MechanicLocationHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('latitude', models.FloatField()),
                ('longitude', models.FloatField()),
                ('accuracy', models.FloatField(blank=True, null=True)),
                ('recorded_at', models.DateTimeField(auto_now_add=True)),
                ('mechanic', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='location_history', to='accounts.mechanic')),
            ],
            options={
                'ordering': ['-recorded_at'],
            },
        ),
        migrations.CreateModel(
            name='MaintenanceRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField(default=django.utils.timezone.now)),
                ('description', models.TextField()),
                ('odometer_reading', models.PositiveIntegerField(blank=True, null=True)),
                ('cost', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('next_due', models.DateField(blank=True, null=True)),
                ('vehicle', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='maintenance_records', to='accounts.fleetvehicle')),
            ],
            options={
                'verbose_name': 'Maintenance Record',
                'verbose_name_plural': 'Maintenance Records',
                'ordering': ['-date'],
            },
        ),
        migrations.CreateModel(
            name='JobHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('job_date', models.DateField(help_text='Date the specific job was performed.', verbose_name='Date of Job/Service')),
                ('description', models.TextField(help_text='Description of the service or parts used.', verbose_name='Job Description')),
                ('service_cost', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text="Corresponds to the 'amount' field from the invoice line item.", max_digits=10, verbose_name='Pre-tax Service/Parts Cost')),
                ('tax_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text="Corresponds to the 'tax_collected' field from the invoice line item.", max_digits=10, verbose_name='Tax Amount on this Job')),
                ('total_job_cost', models.DecimalField(decimal_places=2, editable=False, max_digits=10, verbose_name='Total Cost for this Job (including tax)')),
                ('notes', models.TextField(blank=True, null=True, verbose_name='Additional Notes (e.g., ticket, jobsite, truck, driver)')),
                ('invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='job_history_entries', to='accounts.groupedinvoice', verbose_name='Originating Invoice')),
                ('source_income_record', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='job_history_entry', to='accounts.incomerecord2', verbose_name='Source Invoice Line Item')),
                ('vehicle', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='job_history', to='accounts.vehicle', verbose_name='Associated Vehicle')),
            ],
            options={
                'verbose_name': 'Job History Record',
                'verbose_name_plural': 'Job History Records',
                'ordering': ['-job_date', 'vehicle'],
            },
        ),
        migrations.CreateModel(
            name='InvoiceDetail',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('bill_to', models.TextField(help_text='Enter the full billing address')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Invoice Detail',
                'verbose_name_plural': 'Invoice Details',
            },
        ),
        migrations.CreateModel(
            name='InvoiceActivity',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('event_type', models.CharField(choices=[('email_sent', 'Email sent'), ('email_opened', 'Email opened'), ('viewed', 'Viewed')], max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('actor', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='invoice_activities', to=settings.AUTH_USER_MODEL)),
                ('invoice', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='activity_entries', to='accounts.groupedinvoice')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='InventoryTransaction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('transaction_type', models.CharField(choices=[('IN', 'Stock In'), ('OUT', 'Stock Out'), ('ADJUSTMENT', 'Adjustment')], max_length=20)),
                ('quantity', models.PositiveIntegerField()),
                ('transaction_date', models.DateTimeField(default=django.utils.timezone.now)),
                ('remarks', models.TextField(blank=True, null=True)),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transactions', to='accounts.product')),
                ('user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='inventory_transactions', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='InventoryLocation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='inventory_locations', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.AddField(
            model_name='incomerecord2',
            name='paid_invoice',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='income_records', to='accounts.paidinvoice'),
        ),
        migrations.AddField(
            model_name='incomerecord2',
            name='payment',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='income_records', to='accounts.payment'),
        ),
        migrations.AddField(
            model_name='incomerecord2',
            name='pending_invoice',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='income_records', to='accounts.pendinginvoice'),
        ),
        migrations.AddField(
            model_name='incomerecord2',
            name='product',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounts.product'),
        ),
        migrations.CreateModel(
            name='IncomeRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField(null=True)),
                ('ticket', models.FloatField(blank=True, default=0)),
                ('jobsite', models.FloatField(null=True)),
                ('truck', models.FloatField(default=3335)),
                ('job', models.CharField(blank=True, max_length=20)),
                ('qty', models.FloatField(default=0)),
                ('rate', models.FloatField(default=0)),
                ('amount', models.FloatField(default=0, editable=False)),
                ('tax_collected', models.FloatField(default=0, editable=False)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Income Record',
                'verbose_name_plural': 'Income Records',
            },
        ),
        migrations.CreateModel(
            name='GroupedEstimate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('po_number', models.CharField(blank=True, max_length=20, null=True)),
                ('date', models.DateField(null=True)),
                ('date_from', models.DateField(blank=True, null=True)),
                ('date_to', models.DateField(blank=True, null=True)),
                ('bill_to', models.CharField(max_length=50, null=True)),
                ('bill_to_address', models.TextField(blank=True, null=True)),
                ('bill_to_email', models.EmailField(max_length=254, null=True)),
                ('vin_no', models.CharField(blank=True, max_length=17, null=True)),
                ('mileage', models.FloatField(blank=True, null=True)),
                ('unit_no', models.CharField(blank=True, max_length=64, null=True)),
                ('make_model', models.CharField(blank=True, max_length=25, null=True)),
                ('estimate_number', models.CharField(blank=True, editable=False, max_length=20, null=True, unique=True)),
                ('total_amount', models.DecimalField(decimal_places=2, default=0, editable=False, max_digits=10)),
                ('is_subscription', models.BooleanField(default=False)),
                ('subscription_frequency', models.CharField(blank=True, choices=[('daily', 'Daily'), ('weekly', 'Weekly'), ('biweekly', 'Bi-Weekly'), ('monthly', 'Monthly'), ('quarterly', 'Quarterly'), ('yearly', 'Yearly')], max_length=10, null=True)),
                ('tax_exempt', models.BooleanField(default=False)),
                ('tax_exempt_reason', models.CharField(blank=True, max_length=255, null=True)),
                ('customer', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='estimates', to='accounts.customer')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Estimate',
                'verbose_name_plural': 'Estimates',
            },
        ),
        migrations.CreateModel(
            name='ExpenseRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField(null=True)),
                ('fuel', models.FloatField(default=0)),
                ('plates', models.FloatField(default=0)),
                ('wsib', models.FloatField(default=0)),
                ('repairs', models.FloatField(default=0)),
                ('parking', models.FloatField(default=0)),
                ('wash', models.FloatField(default=0)),
                ('def_fluid', models.FloatField(default=0)),
                ('insurance', models.FloatField(default=0)),
                ('total', models.FloatField(default=0, editable=False)),
                ('tax_paid', models.FloatField(default=0, editable=False)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Expense Record',
                'verbose_name_plural': 'Expense Records',
            },
        ),
        migrations.CreateModel(
            name='EstimateRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('job', models.CharField(blank=True, max_length=2000)),
                ('qty', models.FloatField(default=0, null=True)),
                ('rate', models.FloatField(default=0, null=True)),
                ('amount', models.FloatField(default=0, editable=False)),
                ('tax_collected', models.FloatField(default=0, editable=False)),
                ('date', models.DateField(blank=True, null=True)),
                ('ticket', models.CharField(blank=True, max_length=16, null=True)),
                ('jobsite', models.CharField(blank=True, max_length=16, null=True)),
                ('truck', models.CharField(blank=True, max_length=16, null=True)),
                ('driver', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounts.driver')),
                ('grouped_estimate', models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, related_name='estimate_records', to='accounts.groupedestimate')),
                ('product', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounts.product')),
            ],
            options={
                'verbose_name': 'Estimate Record',
                'verbose_name_plural': 'Estimate Records',
            },
        ),
        migrations.CreateModel(
            name='EmployeeTaxProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('province', models.CharField(choices=[('AB', 'Alberta'), ('BC', 'British Columbia'), ('MB', 'Manitoba'), ('NB', 'New Brunswick'), ('NL', 'Newfoundland and Labrador'), ('NT', 'Northwest Territories'), ('NS', 'Nova Scotia'), ('NU', 'Nunavut'), ('ON', 'Ontario'), ('PE', 'Prince Edward Island'), ('QC', 'Quebec'), ('SK', 'Saskatchewan'), ('YT', 'Yukon'), ('CU', 'Custom')], default='ON', max_length=2)),
                ('federal_claim_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('provincial_claim_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('additional_withholding', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('cpp_exempt', models.BooleanField(default=False)),
                ('ei_exempt', models.BooleanField(default=False)),
                ('cpp2_exempt', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('employee', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='tax_profile', to='accounts.employee')),
            ],
        ),
        migrations.CreateModel(
            name='EmployeeRecurringDeduction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200)),
                ('amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('is_pre_tax', models.BooleanField(default=False)),
                ('is_employer_contribution', models.BooleanField(default=False)),
                ('is_employee_contribution', models.BooleanField(default=True)),
                ('active', models.BooleanField(default=True)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='recurring_deductions', to='accounts.employee')),
            ],
        ),
        migrations.AddField(
            model_name='employee',
            name='mechanic',
            field=models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='employee_profile', to='accounts.mechanic'),
        ),
        migrations.AddField(
            model_name='employee',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='employees', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='DriverSettlementStatement',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date_created', models.DateField(auto_now_add=True)),
                ('date_from', models.DateField()),
                ('date_to', models.DateField()),
                ('settlement_total', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('tax_total', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('driver', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='accounts.driver')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='DriverSettlementActivity',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('job', models.CharField(max_length=255)),
                ('qty', models.DecimalField(decimal_places=2, max_digits=10)),
                ('rate', models.DecimalField(decimal_places=2, max_digits=10)),
                ('date', models.DateField()),
                ('ticket', models.CharField(blank=True, max_length=50, null=True)),
                ('jobsite', models.CharField(blank=True, max_length=255, null=True)),
                ('truck', models.CharField(blank=True, max_length=50, null=True)),
                ('settlement', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='activities', to='accounts.driversettlementstatement')),
            ],
        ),
        migrations.CreateModel(
            name='CloverConnection',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('merchant_id', models.CharField(max_length=64, unique=True)),
                ('access_token', models.TextField()),
                ('refresh_token', models.TextField(blank=True, null=True)),
                ('token_type', models.CharField(blank=True, max_length=32)),
                ('token_expires_at', models.DateTimeField(blank=True, null=True)),
                ('env', models.CharField(choices=[('sandbox', 'Sandbox'), ('production', 'Production')], default='sandbox', max_length=16)),
                ('sync_pos_payments', models.BooleanField(default=True)),
                ('sync_online_payments', models.BooleanField(default=True)),
                ('last_sync_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='clover_connection', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Clover Connection',
                'verbose_name_plural': 'Clover Connections',
            },
        ),
        migrations.CreateModel(
            name='CategoryGroup',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=120)),
                ('description', models.TextField(blank=True, null=True)),
                ('image', models.ImageField(blank=True, null=True, upload_to='category_group_images/')),
                ('sort_order', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='category_groups', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['sort_order', 'name'],
            },
        ),
        migrations.AddField(
            model_name='category',
            name='group',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='categories', to='accounts.categorygroup'),
        ),
        migrations.AddField(
            model_name='category',
            name='parent',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='children', to='accounts.category'),
        ),
        migrations.AddField(
            model_name='category',
            name='user',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='categories', to=settings.AUTH_USER_MODEL),
        ),
        migrations.CreateModel(
            name='BusinessBankAccount',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=120)),
                ('account_number', models.CharField(blank=True, max_length=60)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='business_bank_accounts', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Business Bank Account',
                'verbose_name_plural': 'Business Bank Accounts',
                'ordering': ['name', 'id'],
            },
        ),
        migrations.CreateModel(
            name='BankTransaction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('provider', models.CharField(choices=[('flinks', 'Flinks')], default='flinks', max_length=20)),
                ('external_id', models.CharField(max_length=128)),
                ('account_id', models.CharField(blank=True, max_length=128)),
                ('account_name', models.CharField(blank=True, max_length=120)),
                ('institution_name', models.CharField(blank=True, max_length=120)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('currency', models.CharField(default='CAD', max_length=10)),
                ('description', models.TextField(blank=True)),
                ('merchant_name', models.CharField(blank=True, max_length=120)),
                ('posted_at', models.DateField(blank=True, null=True)),
                ('authorized_at', models.DateField(blank=True, null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending review'), ('approved', 'Approved'), ('ignored', 'Ignored')], default='pending', max_length=20)),
                ('reviewed_at', models.DateTimeField(blank=True, null=True)),
                ('raw_data', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('connection', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='accounts.bankconnection')),
                ('linked_expense', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='bank_transactions', to='accounts.mechexpense')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='bank_transactions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Bank Transaction',
                'verbose_name_plural': 'Bank Transactions',
            },
        ),
        migrations.CreateModel(
            name='BankingIntegrationSettings',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('provider', models.CharField(choices=[('flinks', 'Flinks')], default='flinks', max_length=20)),
                ('enabled', models.BooleanField(default=False)),
                ('auto_sync_enabled', models.BooleanField(default=True)),
                ('require_review', models.BooleanField(default=True, help_text='Queue transactions for review before creating expenses.')),
                ('last_synced_at', models.DateTimeField(blank=True, null=True)),
                ('last_sync_status', models.CharField(blank=True, max_length=255)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='banking_settings', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Banking Integration',
                'verbose_name_plural': 'Banking Integrations',
            },
        ),
        migrations.CreateModel(
            name='ActivityLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(max_length=64)),
                ('object_type', models.CharField(max_length=64)),
                ('object_id', models.CharField(blank=True, max_length=64)),
                ('description', models.TextField()),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('actor', models.ForeignKey(blank=True, help_text='Staff member who performed the action.', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='performed_activities', to=settings.AUTH_USER_MODEL)),
                ('business', models.ForeignKey(help_text='Primary business account that owns the record.', on_delete=django.db.models.deletion.CASCADE, related_name='activity_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddConstraint(
            model_name='vehicleserviceportaloverride',
            constraint=models.UniqueConstraint(fields=('vehicle', 'service'), name='unique_vehicle_service_portal_override'),
        ),
        migrations.AddConstraint(
            model_name='vehicle',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('vin_number'), models.F('customer'), condition=models.Q(('vin_number__isnull', False), models.Q(('vin_number', ''), _negated=True)), name='unique_vehicle_vin_per_customer'),
        ),
        migrations.AlterUniqueTogether(
            name='transportvehicle',
            unique_together={('user', 'unit_number')},
        ),
        migrations.AddConstraint(
            model_name='transportorder',
            constraint=models.UniqueConstraint(fields=('user', 'order_number'), name='uniq_order_per_user'),
        ),
        migrations.AlterUniqueTogether(
            name='transportdriver',
            unique_together={('user', 'employee_id')},
        ),
        migrations.AlterUniqueTogether(
            name='timesheetsnapshot',
            unique_together={('timesheet', 'source')},
        ),
        migrations.AlterUniqueTogether(
            name='timesheet',
            unique_together={('employee', 'period_start', 'period_end')},
        ),
        migrations.AlterUniqueTogether(
            name='timeentry',
            unique_together={('timesheet', 'work_date')},
        ),
        migrations.AlterUniqueTogether(
            name='taxexemptionreason',
            unique_together={('user', 'reason')},
        ),
        migrations.AddConstraint(
            model_name='supplier',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('name'), models.F('user'), name='unique_supplier_name_per_user'),
        ),
        migrations.AddConstraint(
            model_name='storefrontheroshowcaseitem',
            constraint=models.UniqueConstraint(fields=('hero', 'product'), name='unique_hero_showcase_product'),
        ),
        migrations.AddConstraint(
            model_name='servicejobname',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('name'), models.F('user'), name='unique_service_job_name_per_user'),
        ),
        migrations.AlterUniqueTogether(
            name='servicedescription',
            unique_together={('service', 'description')},
        ),
        migrations.AddConstraint(
            model_name='service',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('name'), models.F('job_name'), name='unique_service_description_per_job_name'),
        ),
        migrations.AddIndex(
            model_name='quickbooksimportmap',
            index=models.Index(fields=['user', 'object_type', 'qbo_id'], name='accounts_qu_user_id_bc83f7_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='quickbooksimportmap',
            unique_together={('user', 'object_type', 'qbo_id')},
        ),
        migrations.AddConstraint(
            model_name='productvin',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('vin'), models.F('user'), name='unique_vin_per_user'),
        ),
        migrations.AddConstraint(
            model_name='productmodel',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('name'), models.F('user'), name='unique_model_name_per_user'),
        ),
        migrations.AddConstraint(
            model_name='productbrand',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('name'), models.F('user'), name='unique_brand_name_per_user'),
        ),
        migrations.AddConstraint(
            model_name='productattributevalue',
            constraint=models.UniqueConstraint(fields=('product', 'attribute'), name='unique_product_attribute_value'),
        ),
        migrations.AddConstraint(
            model_name='product',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('sku'), models.F('user'), condition=models.Q(('sku__isnull', False), models.Q(('sku', ''), _negated=True)), name='unique_product_sku_per_user'),
        ),
        migrations.AddConstraint(
            model_name='product',
            constraint=models.UniqueConstraint(fields=('user', 'quickbooks_item_id'), name='unique_product_quickbooks_item_per_user'),
        ),
        migrations.AlterUniqueTogether(
            name='paystub',
            unique_together={('payroll_run', 'employee')},
        ),
        migrations.AlterUniqueTogether(
            name='payrolltaxbracket',
            unique_together={('tax_year', 'jurisdiction', 'bracket_min', 'bracket_max')},
        ),
        migrations.AlterUniqueTogether(
            name='payrollrun',
            unique_together={('user', 'period_start', 'period_end')},
        ),
        migrations.AlterUniqueTogether(
            name='payrollprovincetaxsetting',
            unique_together={('tax_year', 'province')},
        ),
        migrations.AlterUniqueTogether(
            name='payrollemployertax',
            unique_together={('tax_year', 'province', 'name')},
        ),
        migrations.AddConstraint(
            model_name='inventorylocation',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('name'), models.F('user'), name='unique_location_name_per_user'),
        ),
        migrations.AddConstraint(
            model_name='groupedinvoice',
            constraint=models.UniqueConstraint(condition=models.Q(('invoice_number__isnull', True), _negated=True), fields=('user', 'invoice_number'), name='unique_invoice_number_per_user'),
        ),
        migrations.AddConstraint(
            model_name='groupedinvoice',
            constraint=models.UniqueConstraint(condition=models.Q(('quickbooks_invoice_id__isnull', True), _negated=True), fields=('user', 'quickbooks_invoice_id'), name='unique_quickbooks_invoice_per_user'),
        ),
        migrations.AlterUniqueTogether(
            name='customer',
            unique_together={('user', 'quickbooks_customer_id')},
        ),
        migrations.AddConstraint(
            model_name='categorygroup',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('name'), models.F('user'), name='unique_category_group_name_per_user'),
        ),
        migrations.AddConstraint(
            model_name='categoryattributeoption',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('value'), models.F('attribute'), name='unique_attribute_option_per_attribute'),
        ),
        migrations.AddConstraint(
            model_name='categoryattribute',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('name'), models.F('category'), name='unique_attribute_name_per_category'),
        ),
        migrations.AddConstraint(
            model_name='category',
            constraint=models.UniqueConstraint(django.db.models.functions.text.Lower('name'), models.F('user'), name='unique_category_name_per_user'),
        ),
        migrations.AlterUniqueTogether(
            name='businessbankaccount',
            unique_together={('user', 'name', 'account_number')},
        ),
        migrations.AddIndex(
            model_name='banktransaction',
            index=models.Index(fields=['user', 'status', 'posted_at'], name='accounts_ba_user_id_a06092_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='banktransaction',
            unique_together={('user', 'provider', 'external_id')},
        ),
        migrations.AlterUniqueTogether(
            name='bankconnection',
            unique_together={('user', 'provider', 'connection_id')},
        ),
        migrations.AddIndex(
            model_name='activitylog',
            index=models.Index(fields=['business', 'created_at'], name='accounts_ac_busines_7c285e_idx'),
        ),
        migrations.AddIndex(
            model_name='activitylog',
            index=models.Index(fields=['object_type', 'object_id'], name='accounts_ac_object__031b8c_idx'),
        ),
    ]
