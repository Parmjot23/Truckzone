{% extends "suppliers/portal_base.html" %}
{% load form_tags %}
{% block title %}Contact {{ business_name|default:default_business_name }}{% endblock %}
{% block extra_css %}{{ block.super }}
  <style>
    .supplier-contact-card {
      border-radius: 24px;
      border: 1px solid rgba(14, 165, 233, 0.18);
      box-shadow: 0 18px 40px rgba(14, 116, 144, 0.12);
      background: #ffffff;
    }

    .supplier-contact-card h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: #0f172a;
    }

    .supplier-contact-card .form-label {
      font-weight: 600;
      color: #0f172a;
    }

    .supplier-contact-card .btn-info {
      background: linear-gradient(135deg, #0ea5e9, #0f766e);
      border: none;
    }

    .supplier-contact-card .btn-info:hover {
      background: linear-gradient(135deg, #0f766e, #0ea5e9);
    }
  </style>
{% endblock %}
{% block portal_content %}
  <div class="row justify-content-center">
    <div class="col-xl-7 col-lg-8">
      <div class="supplier-contact-card p-4 p-lg-5">
        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-start gap-4 mb-4">
          <div>
            <span class="badge bg-info-subtle text-info mb-2">Direct line to {{ business_name|default:default_business_name }}</span>
            <h2 class="mb-2">Tell us what you need</h2>
            <p class="text-muted mb-0">Use this form to flag restock requests, share delivery updates, or ask about invoices. The {{ business_name|default:default_business_name }} support team will respond right away.</p>
          </div>
          <div class="border rounded-4 bg-light p-3 small">
            <div class="fw-semibold text-uppercase text-muted mb-2">Current contact</div>
            <ul class="list-unstyled mb-0">
              {% if business_contact.email %}
                <li class="mb-1"><i class="fas fa-envelope text-info me-2"></i>{{ business_contact.email }}</li>
              {% endif %}
              {% if business_contact.phone %}
                <li class="mb-1"><i class="fas fa-phone text-info me-2"></i>{{ business_contact.phone }}</li>
              {% endif %}
              {% if business_contact.support_url %}
                <li class="mb-0"><i class="fas fa-link text-info me-2"></i><a href="{{ business_contact.support_url }}" class="text-decoration-none">Support portal</a></li>
              {% endif %}
            </ul>
          </div>
        </div>

        {% if messages %}
          <div class="alert alert-success" role="status">
            {% for message in messages %}
              <div>{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}

        {% with subject_value=form.subject.value reference_value=form.reference_code.value %}
          {% if subject_value %}
            <div class="alert alert-info small" role="note">
              <strong>Regarding:</strong> {{ subject_value }}
              {% if reference_value %}
                <span class="d-block">Reference ID: {{ reference_value }}</span>
              {% endif %}
            </div>
          {% endif %}
        {% endwith %}

        <form method="post" novalidate class="row g-3">
          {% csrf_token %}
          {% if form.non_field_errors %}
            <div class="col-12">
              <div class="alert alert-danger small mb-0">{{ form.non_field_errors }}</div>
            </div>
          {% endif %}
          <div class="col-md-6">
            <label for="id_message_type" class="form-label">{{ form.message_type.label }}</label>
            {{ form.message_type|add_class:'form-select' }}
            {% if form.message_type.errors %}
              <div class="text-danger small">{{ form.message_type.errors|striptags }}</div>
            {% endif %}
          </div>
          <div class="col-md-6">
            <label for="id_reference_code" class="form-label">{{ form.reference_code.label }}</label>
            {{ form.reference_code|add_class:'form-control' }}
            {% if form.reference_code.errors %}
              <div class="text-danger small">{{ form.reference_code.errors|striptags }}</div>
            {% endif %}
          </div>
          <div class="col-md-6">
            <label for="id_subject" class="form-label">{{ form.subject.label }}</label>
            {{ form.subject|add_class:'form-control' }}
            {% if form.subject.errors %}
              <div class="text-danger small">{{ form.subject.errors|striptags }}</div>
            {% endif %}
          </div>
          <div class="col-md-6">
            <label for="id_full_name" class="form-label">{{ form.full_name.label }}</label>
            {{ form.full_name|add_class:'form-control' }}
            {% if form.full_name.errors %}
              <div class="text-danger small">{{ form.full_name.errors|striptags }}</div>
            {% endif %}
          </div>
          <div class="col-md-6">
            <label for="id_email" class="form-label">{{ form.email.label }}</label>
            {{ form.email|add_class:'form-control' }}
            {% if form.email.errors %}
              <div class="text-danger small">{{ form.email.errors|striptags }}</div>
            {% endif %}
          </div>
          <div class="col-md-6">
            <label for="id_phone" class="form-label">{{ form.phone.label }}</label>
            {{ form.phone|add_class:'form-control' }}
            {% if form.phone.errors %}
              <div class="text-danger small">{{ form.phone.errors|striptags }}</div>
            {% endif %}
          </div>
          <div class="col-12">
            <label for="id_message" class="form-label">{{ form.message.label }}</label>
            {{ form.message|add_class:'form-control' }}
            {% if form.message.errors %}
              <div class="text-danger small">{{ form.message.errors|striptags }}</div>
            {% endif %}
          </div>
          <input type="hidden" name="service_type" value="{{ service_type }}">
          <div class="col-12">
            <button type="submit" class="btn btn-info text-white w-100">Send message</button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock %}
