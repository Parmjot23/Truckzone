{# templates/emails/invoice_email_paid.html #}
{% load custom_filters %}
{% with brand=profile.invoice_header_color|default:"#4a90e2" %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Invoice #{{ invoice.invoice_number }} – {{ profile.company_name }}</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">

<style>
/* ----------  RESET & TOKENS  ---------- */
html,body{margin:0;padding:0;width:100%;background:#f3f5f9;font-family:"Inter",Arial,sans-serif;color:#333;}
table{border-collapse:collapse;width:100%;}
a{color:{{ brand }};text-decoration:none;}
.wrapper{max-width:680px;margin:40px auto;background:#fff;border-radius:10px;border:1px solid #e5e8ef;
         box-shadow:0 6px 18px rgba(0,0,0,.06);overflow:hidden;}
.content{padding:40px;position:relative;}

/* ----------  HEADER  ---------- */
.header{display:flex;align-items:center;gap:18px;margin-bottom:32px;padding-bottom:20px;border-bottom:4px solid {{ brand }};}
.header img{max-height:64px;}
.header h1{margin:0;font-size:28px;color:{{ brand }};font-weight:700;}

/* ----------  PAID RIBBON  ---------- */
.ribbon{position:absolute;top:26px;right:-44px;background:#28a745;color:#fff;padding:8px 76px;
        transform:rotate(45deg);font-size:14px;font-weight:700;box-shadow:0 3px 8px rgba(0,0,0,.12);
        text-transform:uppercase;letter-spacing:.5px;}

/* ----------  TEXT  ---------- */
p{margin:0 0 18px;font-size:15px;line-height:1.55;}
.greeting{font-size:16px;font-weight:500;}

/* ----------  SUMMARY  ---------- */
.summary{background:#fbfcff;border:1px solid #e5e8ef;border-radius:10px;padding:22px;margin:24px 0;}
.summary-row{display:flex;justify-content:space-between;font-size:14px;margin-bottom:10px;}
.summary-row strong{font-weight:600;}

/* ----------  TOTAL BAR  ---------- */
.total-paid{background:#28a745;      /* changed from {{ brand }} to green */
            color:#fff;text-align:center;border-radius:10px;
            padding:22px;font-size:22px;font-weight:700;letter-spacing:.2px;margin:28px 0 32px;}
.total-paid small{font-size:16px;font-weight:500;display:block;margin-top:6px;}

/* ----------  TABLES  ---------- */
th,td{padding:14px 10px;font-size:14px;border-bottom:1px solid #e5e8ef;}
th{background:{{ brand }};color:#fff;text-align:left;font-weight:600;}
th:nth-child(n+2),td:nth-child(n+2){text-align:right;}
tbody tr:nth-child(even){background:#fafbfe;}
.payments h2{font-size:16px;margin:0 0 10px;}
.payments table td{font-size:13px;}

/* ----------  SMALL PRINT  ---------- */
.note{font-size:13px;color:#5f6b7a;margin:24px 0;}
.footer{background:#f0f2f7;color:#8d96a6;font-size:12px;text-align:center;
        padding:20px;border-top:1px solid #e5e8ef;}

/* ----------  MOBILE  ---------- */
@media(max-width:520px){
  .content{padding:24px;}
  .header{flex-direction:column;align-items:flex-start;gap:12px;}
  .total-paid{font-size:18px;padding:18px;}
  th,td{font-size:13px;}
}
</style>
</head>

<body>
<div class="wrapper">
    <div class="content">
        <!-- Header -->
        <div class="header">
          {% if company_logo_url %}<img src="{{ company_logo_url }}" alt="{{ profile.company_name }} logo">{% endif %}
          <h1>Invoice #{{ invoice.invoice_number }}</h1>
        </div>

        <!-- Greeting -->
        <p class="greeting">Hello {{ invoice.bill_to }},</p>
        <p>We’re pleased to confirm that payment for the invoice referenced above was received in full.
        </p>

        {% if payment_receipt_url %}
          <p style="margin: 0 0 18px; font-size:15px; line-height:1.55;">
            You can also view your official payment receipt here:
            <a href="{{ payment_receipt_url }}" target="_blank">View Receipt</a>.
          </p>
        {% endif %}

        <!-- Summary -->
        <div class="summary">
          <div class="summary-row"><strong>Date&nbsp;Issued:</strong><span>{{ invoice.date }}</span></div>
          <div class="summary-row"><strong>Date&nbsp;Paid:</strong><span>{{ invoice.date_fully_paid|default:'—' }}</span></div>
          <div class="summary-row"><strong>Subtotal:</strong><span>{{ subtotal|currency }}</span></div>
          <div class="summary-row"><strong>{{ profile.get_tax_name }}:</strong><span>{{ tax|currency }}</span></div>
        </div>

        <div class="total-paid">
          Total&nbsp;Amount&nbsp;Due:&nbsp;{{ balance_due|currency }}
        </div>


        <!-- Items -->
        <table>
          <thead><tr><th>Description</th><th>Qty</th><th>Rate</th><th>Total</th></tr></thead>
          <tbody>
          {% for job in invoice.income_records.all %}
            <tr><td>{{ job.job|linebreaksbr }}</td><td>{{ job.qty }}</td><td>{{ job.rate|currency }}</td><td>{{ job.amount|currency }}</td></tr>
          {% empty %}
            <tr><td colspan="4" style="text-align:center;padding:20px;color:#8d96a6;">No billable items.</td></tr>
          {% endfor %}
          </tbody>
        </table>



        <p>For any questions, simply reply to this e-mail or contact us at
           <a href="mailto:{{ profile.company_email }}">{{ profile.company_email }}</a>.</p>

        <p>Thank you for choosing <strong>{{ profile.company_name }}</strong>!</p>
      </div>

      <div class="footer">
        &copy;&nbsp;{{ now|date:"Y" }} {{ profile.company_name }} &nbsp;•&nbsp;
        <a href="https://www.smart-invoices.com" style="color:inherit;text-decoration:none;">www.smart-invoices.com</a>
      </div>
    </div>
</div>
  {% if invoice_open_tracking_url %}
    <img src="{{ invoice_open_tracking_url }}" alt="" width="1" height="1" style="display:none;">
  {% endif %}
</body>
</html>
{% endwith %}
