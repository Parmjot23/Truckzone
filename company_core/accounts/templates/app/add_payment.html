<!-- app/add_payment.html -->
{% extends 'customer_portal_base.html' %}
{% load custom_filters %}
{% block title %}
    Add Payment
{% endblock %}
{% block content %}
<style>
    .payment-form {
        max-width: 600px;
        margin: 0 auto;
    }
    .payment-form .form-group {
        margin-bottom: 15px;
    }
</style>
<div class="container mt-5">
    <div class="payment-form">
        <h2>Add Payment for Invoice {{ invoice.invoice_number }}</h2>
        <p><strong>Customer:</strong> {{ invoice.user.get_full_name }} ({{ invoice.user.email }})</p>
        <p><strong>Invoice Total:</strong> {{ invoice.total_amount|currency }}</p>
        <p><strong>Amount Paid:</strong> {{ invoice.amount_paid|currency }}</p>
        <p><strong>Balance Due:</strong> {{ invoice.balance_due|currency }}</p>
        <form method="POST" action="{% url 'accounts:add_payment' invoice.bill_to 'all' %}">
            {% csrf_token %}
            {{ form.non_field_errors }}
            <div class="form-group">
                <label for="id_amount">Amount</label>
                {{ form.amount.errors }}
                {{ form.amount }}
            </div>
            <div class="form-group">
                <label for="id_payment_method">Payment Method</label>
                {{ form.payment_method.errors }}
                {{ form.payment_method }}
            </div>
            <div class="form-group" id="reference-number-group" style="display: none;">
                <label for="id_reference_number">Reference Number</label>
                {{ form.reference_number.errors }}
                {{ form.reference_number }}
            </div>
            <button type="submit" class="btn btn-primary">Submit Payment</button>
            <a href="{% url 'accounts:customer_list' %}" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const paymentMethodSelect = document.getElementById('id_payment_method');
        const referenceNumberGroup = document.getElementById('reference-number-group');

        paymentMethodSelect.addEventListener('change', function() {
            if (this.value === 'bank_transfer') {
                referenceNumberGroup.style.display = 'block';
            } else {
                referenceNumberGroup.style.display = 'none';
                document.getElementById('id_reference_number').value = '';
            }
        });
    });
</script>
{% endblock %}
