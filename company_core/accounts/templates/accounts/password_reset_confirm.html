{% extends "base.html" %}
{% load static %}

{% block title %}Reset Your Password{% endblock %}

{% block content %}
<div class="main-container mt-4">
    <h2 class="mb-3 header">Reset Your Password</h2>
    <form method="post" class="form-container">
        {% csrf_token %}
        <div class="form-group">
            {{ form.new_password1.label_tag }}
            {{ form.new_password1 }}
            <span class="password-indicator" id="password-strength-icon" class="error"></span>
            <small class="form-text text-muted" id="password-strength" class="error"></small>
            {% if form.new_password1.errors %}
                <div class="error">{{ form.new_password1.errors }}</div>
            {% endif %}
        </div>
        <div class="form-group">
            {{ form.new_password2.label_tag }}
            {{ form.new_password2 }}
            <span class="password-indicator" id="password-match-icon" class="error"></span>
            <small class="form-text text-muted" id="password-match" class="error"></small>
            {% if form.new_password2.errors %}
                <div class="error">{{ form.new_password2.errors }}</div>
            {% endif %}
        </div>
        <button type="submit" class="form-button">Reset Password</button>
    </form>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var password1 = document.getElementById('id_new_password1');
    var password2 = document.getElementById('id_new_password2');
    var strengthIcon = document.getElementById('password-strength-icon');
    var strengthText = document.getElementById('password-strength');
    var matchIcon = document.getElementById('password-match-icon');
    var matchText = document.getElementById('password-match');

    password1.addEventListener('input', function() {
        var strength = getPasswordStrength(password1.value);
        strengthText.textContent = strength.text;
        strengthIcon.textContent = strength.icon;
    });

    password2.addEventListener('input', function() {
        if (password1.value === password2.value) {
            matchText.textContent = 'Passwords match';
            matchIcon.textContent = '✔'; // Unicode check mark
        } else {
            matchText.textContent = 'Passwords do not match';
            matchIcon.textContent = '✘'; // Unicode cross
        }
    });

    function getPasswordStrength(password) {
        var strength = { text: '', icon: '' };
        if (password.length < 8) {
            strength.text = 'Weak (minimum length is 8 characters)';
            strength.icon = '✘'; // Unicode cross
        } else if (!/\d/.test(password) || !/[a-zA-Z]/.test(password)) {
            strength.text = 'Weak (must contain letters and numbers)';
            strength.icon = '✘'; // Unicode cross
        } else if (password.length >= 8 && /\d/.test(password) && /[a-zA-Z]/.test(password)) {
            strength.text = 'Strong';
            strength.icon = '✔'; // Unicode check mark
        } else {
            strength.text = 'Moderate';
            strength.icon = '⚠'; // Unicode warning sign
        }
        return strength;
    }
});
</script>
{% endblock %}
